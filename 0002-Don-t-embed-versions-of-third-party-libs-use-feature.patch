From 6875e01ca3e26b430b54c6bbcc40dd1adf35dfe3 Mon Sep 17 00:00:00 2001
From: Mat Booth <mat.booth@redhat.com>
Date: Fri, 7 Dec 2018 10:17:02 +0000
Subject: [PATCH 2/3] Don't embed versions of third-party libs, use feature
 requirements instead

---
 .../org.eclipse.jgit.feature/feature.xml      | 59 +++----------------
 .../feature.xml                               | 16 +----
 .../feature.xml                               | 24 +-------
 .../org.eclipse.jgit.lfs.feature/feature.xml  |  8 +--
 .../org.eclipse.jgit.pgm.feature/feature.xml  | 24 +-------
 .../feature.xml                               | 24 +-------
 6 files changed, 21 insertions(+), 134 deletions(-)

diff --git a/org.eclipse.jgit.packaging/org.eclipse.jgit.feature/feature.xml b/org.eclipse.jgit.packaging/org.eclipse.jgit.feature/feature.xml
index ce03e05..f32b48b 100644
--- a/org.eclipse.jgit.packaging/org.eclipse.jgit.feature/feature.xml
+++ b/org.eclipse.jgit.packaging/org.eclipse.jgit.feature/feature.xml
@@ -22,6 +22,15 @@
       <discovery label="%updateSiteName" url="http://download.eclipse.org/egit/updates"/>
    </url>
 
+   <requires>
+      <import plugin="com.googlecode.javaewah.JavaEWAH" />
+      <import plugin="com.jcraft.jsch" />
+      <import plugin="com.jcraft.jzlib"/>
+      <import plugin="org.apache.commons.compress" />
+      <import plugin="slf4j.api" />
+      <import plugin="slf4j.simple" />
+   </requires>
+
    <plugin
          id="org.eclipse.jgit"
          download-size="0"
@@ -36,54 +45,4 @@
          version="0.0.0"
          unpack="false"/>
 
-   <plugin
-         id="com.jcraft.jsch"
-         download-size="0"
-         install-size="0"
-         version="0.0.0"
-         unpack="false"/>
-
-   <plugin
-         id="javaewah"
-         download-size="0"
-         install-size="0"
-         version="0.0.0"
-         unpack="false"/>
-
-   <plugin
-         id="org.apache.commons.compress"
-         download-size="0"
-         install-size="0"
-         version="0.0.0"
-         unpack="false"/>
-
-   <plugin
-         id="org.slf4j.api"
-         download-size="0"
-         install-size="0"
-         version="0.0.0"
-         unpack="false"/>
-
-   <plugin
-         id="org.slf4j.impl.log4j12"
-         download-size="0"
-         install-size="0"
-         version="0.0.0"
-         fragment="true"
-         unpack="false"/>
-
-   <plugin
-         id="org.apache.log4j"
-         download-size="0"
-         install-size="0"
-         version="0.0.0"
-         unpack="false"/>
-
-   <plugin
-         id="com.jcraft.jzlib"
-         download-size="0"
-         install-size="0"
-         version="0.0.0"
-         unpack="false"/>
-
 </feature>
diff --git a/org.eclipse.jgit.packaging/org.eclipse.jgit.http.apache.feature/feature.xml b/org.eclipse.jgit.packaging/org.eclipse.jgit.http.apache.feature/feature.xml
index 5780db5..addf7b9 100644
--- a/org.eclipse.jgit.packaging/org.eclipse.jgit.http.apache.feature/feature.xml
+++ b/org.eclipse.jgit.packaging/org.eclipse.jgit.http.apache.feature/feature.xml
@@ -24,6 +24,8 @@
 
    <requires>
       <import plugin="org.eclipse.jgit"/>
+      <import plugin="org.apache.httpcomponents.httpclient" />
+      <import plugin="org.apache.httpcomponents.httpcore" />
    </requires>
 
    <plugin
@@ -33,18 +35,4 @@
          version="0.0.0"
          unpack="false"/>
 
-   <plugin
-         id="org.apache.httpcomponents.httpcore"
-         download-size="0"
-         install-size="0"
-         version="0.0.0"
-         unpack="false"/>
-
-   <plugin
-         id="org.apache.httpcomponents.httpclient"
-         download-size="0"
-         install-size="0"
-         version="0.0.0"
-         unpack="false"/>
-
 </feature>
diff --git a/org.eclipse.jgit.packaging/org.eclipse.jgit.junit.feature/feature.xml b/org.eclipse.jgit.packaging/org.eclipse.jgit.junit.feature/feature.xml
index d55fd5a..d034cc7 100644
--- a/org.eclipse.jgit.packaging/org.eclipse.jgit.junit.feature/feature.xml
+++ b/org.eclipse.jgit.packaging/org.eclipse.jgit.junit.feature/feature.xml
@@ -24,6 +24,9 @@
 
    <requires>
       <import plugin="com.jcraft.jsch"/>
+      <import plugin="org.apache.commons.logging" />
+      <import plugin="org.apache.sshd.core" />
+      <import plugin="org.apache.sshd.sftp" />
    </requires>
 
    <plugin
@@ -54,25 +57,4 @@
          version="0.0.0"
          unpack="false"/>
 
-   <plugin
-         id="org.apache.commons.logging"
-         download-size="0"
-         install-size="0"
-         version="0.0.0"
-         unpack="false"/>
-
-   <plugin
-         id="org.apache.sshd.core"
-         download-size="0"
-         install-size="0"
-         version="0.0.0"
-         unpack="false"/>
-
-   <plugin
-         id="org.apache.sshd.sftp"
-         download-size="0"
-         install-size="0"
-         version="0.0.0"
-         unpack="false"/>
-
 </feature>
diff --git a/org.eclipse.jgit.packaging/org.eclipse.jgit.lfs.feature/feature.xml b/org.eclipse.jgit.packaging/org.eclipse.jgit.lfs.feature/feature.xml
index bb916e4..2d1201c 100644
--- a/org.eclipse.jgit.packaging/org.eclipse.jgit.lfs.feature/feature.xml
+++ b/org.eclipse.jgit.packaging/org.eclipse.jgit.lfs.feature/feature.xml
@@ -24,6 +24,7 @@
 
    <requires>
       <import plugin="org.eclipse.jgit"/>
+      <import plugin="com.google.gson" />
    </requires>
 
    <plugin
@@ -40,11 +41,4 @@
          version="0.0.0"
          unpack="false"/>
 
-   <plugin
-         id="com.google.gson"
-         download-size="0"
-         install-size="0"
-         version="0.0.0"
-         unpack="false"/>
-
 </feature>
diff --git a/org.eclipse.jgit.packaging/org.eclipse.jgit.pgm.feature/feature.xml b/org.eclipse.jgit.packaging/org.eclipse.jgit.pgm.feature/feature.xml
index 43e688e..b9c93e0 100644
--- a/org.eclipse.jgit.packaging/org.eclipse.jgit.pgm.feature/feature.xml
+++ b/org.eclipse.jgit.packaging/org.eclipse.jgit.pgm.feature/feature.xml
@@ -34,6 +34,9 @@
       <import feature="org.eclipse.jgit" version="5.2.0" match="equivalent"/>
       <import feature="org.eclipse.jgit.lfs" version="5.2.0" match="equivalent"/>
       <import feature="org.eclipse.jgit.ssh.apache" version="5.2.0" match="equivalent"/>
+      <import plugin="com.googlecode.javaewah.JavaEWAH" />
+      <import plugin="org.apache.commons.compress" />
+      <import plugin="org.kohsuke.args4j" />
    </requires>
 
    <plugin
@@ -50,25 +53,4 @@
          version="0.0.0"
          unpack="false"/>
 
-   <plugin
-         id="org.apache.commons.compress"
-         download-size="0"
-         install-size="0"
-         version="0.0.0"
-         unpack="false"/>
-
-   <plugin
-         id="org.kohsuke.args4j"
-         download-size="0"
-         install-size="0"
-         version="0.0.0"
-         unpack="false"/>
-
-   <plugin
-         id="javaewah"
-         download-size="0"
-         install-size="0"
-         version="0.0.0"
-         unpack="false"/>
-
 </feature>
diff --git a/org.eclipse.jgit.packaging/org.eclipse.jgit.ssh.apache.feature/feature.xml b/org.eclipse.jgit.packaging/org.eclipse.jgit.ssh.apache.feature/feature.xml
index 3e12d53..e05202e 100644
--- a/org.eclipse.jgit.packaging/org.eclipse.jgit.ssh.apache.feature/feature.xml
+++ b/org.eclipse.jgit.packaging/org.eclipse.jgit.ssh.apache.feature/feature.xml
@@ -24,6 +24,9 @@
 
    <requires>
       <import plugin="org.eclipse.jgit"/>
+      <import plugin="org.apache.sshd.core" />
+      <import plugin="org.apache.sshd.sftp" />
+      <import plugin="net.i2p.crypto.eddsa" />
    </requires>
 
    <plugin
@@ -33,25 +36,4 @@
          version="0.0.0"
          unpack="false"/>
 
-   <plugin
-         id="org.apache.sshd.core"
-         download-size="0"
-         install-size="0"
-         version="0.0.0"
-         unpack="false"/>
-
-   <plugin
-         id="org.apache.sshd.sftp"
-         download-size="0"
-         install-size="0"
-         version="0.0.0"
-         unpack="false"/>
-
-   <plugin
-         id="net.i2p.crypto.eddsa"
-         download-size="0"
-         install-size="0"
-         version="0.0.0"
-         unpack="false"/>
-
 </feature>
-- 
2.19.1

